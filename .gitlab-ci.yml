image: node:13

services:
  - mysql:8.0.19

variables:
  MYSQL_DATABASE: test_db
  MYSQL_ROOT_PASSWORD: mysql
  TEST_DB_DATABASE: test_db
  TEST_DB_HOST: mysql

lint:
  stage: test
  script:
    - npm install
    - npm run test:lint

test-security:
  stage: test
  script:
    - npm install
    - npm run test:audit

test-ava:
  stage: test
  script:
    - npm install
    - npm run migration:test
    - npm run test:ava

test-coverage:
  stage: test
  script:
    - npm install
    - npm run migration:test
    - npm run test:coverage
